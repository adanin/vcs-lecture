Введение

Этим текстом я хочу познакомить вас с системами управления (контроля) версий (Version Control Systems, VCS), их историей и развитием. После краткой исторической справки мы рассмотрим две современные системы - Subversion и Git - и немного попрактикуемся с ними.


Что такое версии, и зачем ими управлять

Представим ситуацию, что я пишу курсовую работу по программированию. Допустим, она состоит из исходных текстов, бинарных файлов, документации и пояснительной записки. В какой-то момент у меня возникает желание переписать один из компонентов программы и сравнить результаты работы старого и нового кода. В простом случае я могу переместить файлы, относящиеся к этому компоненту в какое-нибудь надежное место, написать новый код, потестировать его и принять решение, какую версию компонента мне оставить. Если я оставлю новый компонент, то оакже требуется переписать документацию и подправить пояснительную записку. Старые версии я тоже могу сохранить в надежное местно на будущее. После нескольких таких иттераций я неожиданно выясняю, что в коде компонента допущена серьезная архитектурная ошибка, которая приводит к сбоям в определенных случаях, и имеет смысл продолжать развивать старую, более надежную версию компонента. Я иду в то самое надежное место и восстанавливаю старый код и документацию из архива. Новый код я тоже сохраняю в архив на всякий случай. Через некоторое время я понимаю, что часть наработок кода, который сейчас в архиве, я могу успешно переиспользовать в других частях проекта. А так как у меня есть архивная копия, то мне не нужно писать код заново. Кроме того, во время ревизии документации я нахожу, что когда-то, во время одной из правок, я случайно удалил важную часть документации. Я иду в архив, нахожу там удаленные данные и переношу их в актуальную документацию. Таким образом, имея историю изменений данных в виде архива, я могу успешно переиспользовать уже написанный код, более-менее просто экспериментировать с нововведениями, ослеживать и решать ошибки испорченных данных. Но есть проблема: я должен самостоятельно выработать некоторые правила архивирования (место архива, его структура, правила наименования архивных копий) и вручную осуществлять все с архивом. Кроме того, поскольку я сохраняю предыдущие версии файлов целиком, вне зависимости от объема правок, то, если эти файлы большие, архив достаточно быстро разрастется до приличных размеров.

Еще одну проблему проиллюстрирую следующим примером. В компании, где я работаю, есть некий информационный сервис, который отвечает за получение данных с учетом прав человека их запрашивающего. Людей в компании много, сервис достаточно гибкий, и конфигурационный файл у него большой. Править этот файл имеют право несколько человек. В какой-то момент один из них случайно удаляет важные настройки, отчего сервис перестает работать. Работа компании парализована, начальство требует восстановить работу и наказать виновного. Корректный файл восстановили из архива, а вот кто именно внес критичные изменения, никто не признался. В результате были наказаны все, кто имеют доступ к файлу. Вот ещё пример с этим же сервисом. Двое, в пятницу вечером, в целях выполнения разных заявок стали одновременно редактировать этот файл. Один из них сохранил изменения первым и пошел пренастраивать другой сервис, связанный с этим. Второй тоже сохранил свои изменения, и они стерли изменения первого. В результате у первого не работает другой сервис, а он предывает в полной уверенности, что оба сервиса настроены корректно, и ищет проблему где-то в другом месте. После ночи безуспешных поисков, он все-таки находит ошибку в настройках первого сервиса, устраняет ее и едет домой отсыпаться. Эти два примера иллюстрируют проблемы, возникающие при совместном доступе к данным, когда нужно понимать кто, когда и какие изменения вносил, а также адекватно решать проблемы конкурирующих изменений.

Для решения всех этих проблем и придумали системы управления версиями.


Краткая история управления версиями

Первая система управления версиями появилась в 1972 году и называлась Source Code Control System (SCCS). Основной ее задачей было сохранение только измененных частей файлов (так называемых дельт), а файлов целиком. SCCS была проприетарной. Через десять лет появился свободный и улучшенный вариант SCCS - Revision Control System (RCS). Она имела зачатки для коллективной работы (для редактирования файл блокировался пользователем, и другие не могли его в это время редактировать) и более развитый механизм дельта-компрессии. Историю изменений RCS вела для каждого файла отдельно. В 1990 году под открытой лицензией вышла Concurrent Versions System (CVS), которая была своего рода надстройкой над RCS, обеспечивающей более удобную коллективную работу. Она основывалась на клиент-серверной архитектуре, что позволяло работать по сети (RCS работала только в пределах одной файловой системы; впрочем, ранние версии CVS тоже не поддерживали сетевую работу). CVS умела умно сливать разные изменения одного и того же файла, если они затрагивали разные его участки. Появилась возможность создания ветвей (нескольких параллельно идущих разработок в рамках одного проекта) и меток (позволявших пометить определенные версии файлов одним тегом и впоследствии на них ссылаться). В 2000 году под открытой лицензией появилась Subversion (SVN), которая была создана, чтобы решить родовые проблемы CVS. Она сохраняла версии всего проекта целиком, а не каждого файла в отдельности. Метки и ветви перенесли внутрь проекта (по сути это были отдельные директории). Добавлена возможность сохранять не только содержимое файлов, но и их атрибуты и другие свойства. Теперь между клиентом и сервером передаются только изменения в файлах, а не новые версии целиком. Дельты считаются и для текстовых, и для бинарных файлов (в CVS бинарные файлы сохранялись без дельта-компресии). И многое другое.

Все выше названные системы являются централизованными, так как их клиенты используют какое-то определенное, выделенное место для обмена изменениями, и не могут делать этого напрямую между собой. На данный момент наиболее распространенной централизованной системой управления версиями является Subversion. Конечно, кроме описанных выше были и другие системы этого типа, но они не получили столь широкого распространения как CVS или SVN.